[
  {
    "comment": "login as superuser",
    "request": {
      "session": "new",
      "uri": "accounts/login",
      "entity": {
        "name": "jonathan@kyuss.org",
        "password": "foobar"
      }
    },
    "response": {
      "sessionName": "superuser",
      "session": "sessionId"
    }
  },

  {
    "comment": "test the GDAC feed with earthquake filter",
    "request": {
      "uri": "feeds",
      "handlebarsEnabled": false, // handlebars stuff is for the server, not client
      "entity": {
        "name": "GDAC - Earthquakes",
        "source": "classpath:feeds/gdacs/gdacs-rss.xml",
        "reader": "histori.reader.RssReader",
        "book": "gdacs",
        "poll": "hourly",
        "path": "//channel/item",
        "match": "{{{xpath-match 'calculationtype' 'earthquakeonly'}}}",
        "nexus": {
          "name": "{{{xpath 'title'}}}",
          "markdown": "{{{xpath 'description'}}}",
          "geoJson": "{ \"type\": \"Point\", \"coordinates\": [ {{xpath 'Point/long'}}, {{xpath 'Point/lat'}} ] }",
          "timeRange": {
            "start": "{{{xpath 'fromdate'}}}",
            "end": "{{{xpath 'todate'}}}"
          },
          "tags": [
            {"tagType": "event_type", "tagName": "earthquake"},
            {"tagType": "citation", "tagName": "{{{xpath 'link'}}}"},
            {"tagType": "comment", "tagName": "GUID: {{{xpath 'guid'}}}"},
            {"tagType": "impact", "tagName": "people within 100km", "values": [{"field": "estimate", "value": "{{xpath 'population[@unit=\\'Pop100\\']/@value'}}"}]},
            {"tagType": "impact", "tagName": "magnitude", "values": [{"field": "estimate", "value": "{{xpath 'severity[@unit=\\'M\\']/@value'}}"}]},
            {"tagType": "impact", "tagName": "alert_level", "values": [{"field": "color", "value": "{{xpath 'alertlevel'}}"}]},
            {
              "tagType": "world_actor",
              "tagName": "{{{xpath 'country'}}}",
              "splitName": ",",
              "values": [{"field": "relationship", "value": "affected"}]
            }
          ]
        }
      }
    },
    "response": {
      "type": "histori.model.Feed",
      "check": [
        {"condition": "json.nexuses.size() == 3"}
      ]
    }
  }
,

  {
    "comment": "test the GDAC feed with tropical storms filter",
    "request": {
      "uri": "feeds",
      "handlebarsEnabled": false, // handlebars stuff is for the server, not client
      "entity": {
        "name": "GDAC - Tropical Storms",
        "source": "classpath:feeds/gdacs/gdacs-rss.xml",
        "reader": "histori.reader.RssReader",
        "book": "gdacs",
        "poll": "hourly",
        "path": "//channel/item",
        "match": "{{{xpath-match 'calculationtype' 'tropicalcyclonewithstormsurge'}}}",
        "nexus": {
          "name": "{{{xpath 'title'}}}",
          "markdown": "{{{xpath 'description'}}}",
          "geoJson": "{ \"type\": \"Point\", \"coordinates\": [ {{xpath 'Point/long'}}, {{xpath 'Point/lat'}} ] }",
          "timeRange": {
            "start": "{{{xpath 'fromdate'}}}",
            "end": "{{{xpath 'todate'}}}"
          },
          "tags": [
            {"tagType": "event_type", "tagName": "tropical storm"},
            {"tagType": "citation", "tagName": "{{{xpath 'link'}}}"},
            {"tagType": "comment", "tagName": "GUID: {{{xpath 'guid'}}}"},
            {"tagType": "impact", "tagName": "people affected by Category 1 winds", "values": [{"field": "estimate", "value": "{{xpath 'population[@unit=\\'Pop74\\']/@value'}}"}]},
            {"tagType": "impact", "tagName": "maximum wind speed km/h", "values": [{"field": "estimate", "value": "{{xpath 'severity[@unit=\\'km/h\\']/@value'}}"}]},
            {"tagType": "impact", "tagName": "alert_level", "values": [{"field": "color", "value": "{{xpath 'alertlevel'}}"}]},
            {
              "tagType": "world_actor",
              "tagName": "{{{xpath 'country'}}}",
              "splitName": ",",
              "values": [{"field": "relationship", "value": "affected"}]
            }
          ]
        }
      }
    },
    "response": {
      "type": "histori.model.Feed",
      "check": [
        {"condition": "json.nexuses.size() == 5"}
      ]
    }
  }

]