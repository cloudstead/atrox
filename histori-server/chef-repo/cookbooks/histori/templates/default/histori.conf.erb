<VirtualHost *:443>

ServerName <%=@server_name%>
DocumentRoot <%=@doc_root%>

SSLEngine on
SSLCertificateFile      /etc/ssl/certs/<%=@cert_name%>.pem
SSLCertificateKeyFile   /etc/ssl/private/<%=@cert_name%>.key
SSLCertificateChainFile /etc/ssl/certs/StartSslIntermediate.crt
ServerSignature Off
Header add Strict-Transport-Security: "max-age=15768000;includeSubdomains"

RewriteEngine on
RewriteCond expr "%{REQUEST_URI} -strmatch '/legal/*'"
RewriteRule ^(.*?/legal/(.*))$ http://127.0.0.1:9090/?help=legal.html%3Ft=$2  [P]
#LogLevel alert rewrite:trace6

# these will work in a pinch and are more reliable, if the above ever breaks due to JavaScript madness
#ProxyPass /legal http://127.0.0.1:<%=@api_port%>/api/configs/legal
#ProxyPassReverse /legal http://127.0.0.1:<%=@api_port%>/api/configs/legal

ProxyPass / http://127.0.0.1:<%=@api_port%>/
ProxyPassReverse / http://127.0.0.1:<%=@api_port%>/

ErrorLog ${APACHE_LOG_DIR}/<%=@server_name%>_error.log
CustomLog ${APACHE_LOG_DIR}/<%=@server_name%>_access.log combined env=!dontlog
CustomLog ${APACHE_LOG_DIR}/<%=@server_name%>.log combined

BrowserMatch "MSIE [2-6]" \
nokeepalive ssl-unclean-shutdown \
downgrade-1.0 force-response-1.0
# MSIE 7 and newer should be able to use keepalive
BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown

</VirtualHost>
